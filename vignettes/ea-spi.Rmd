---
title: "ea-spi"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{ea-spi}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(surveyGEER)
library(rgee)
library(tidyverse)
library(tidyrgee)
library(sf)
devtools::load_all()
ee_Initialize()

adm_zone_of_interest_path <-  NULL # here is where you can input a new admin zone for graphing SPI by zone
if(!is.null(adm_zone_of_interest_path)){
  adm_zone_of_interest <- sf::st_read(adm_zone_of_interest_path)
}
# if user supplies no zone of interest path - we can use data built into surveyGEER
if(is.null(adm_zone_of_interest_path)){
  adm_zone_of_interest <-  som_adm1  
}

```

## Intro 
SPI, what it is , how its used
We can simply use the `ee_chirps_spi` function below to do all the calculations for us.
```{r}
spi_3<- ee_chirps_spi(window = 3,window_unit = "month",moi = 4)
```


# Zonal Statistics

Now that we have an image collection for all the 3 month (F-M-A) SPIs from CHIRPS, we can calculate the median SPI for each of those images per zone. In this example we are using admin 1 levels for SOM as our zone.

**Note:** zonal stats using GEE are time-consuming. This could take several minutes, go have a coffee (my first run using the SOM admin 1 zones took 6.8 minutes) 

```{r}

spi_3_adm1 <- spi_3 |> 
  ee_extract_tidy(y= som_adm1,
                  stat = "median",
                  scale=5500,
                  via="drive")
```


# Temporal Visualization
```{r}



spi_bar_plot_faceted(spi_3_adm1,zone ="admin1name")
spi_bar_plot(spi_3_adm1 |> filter(admin1name=="Awdal"))



```





